import{a as I}from"./index.f9aa1d2d.js";import{r as B,c as i,j as e,ab as C}from"./vendor.a38efb6e.js";const E=()=>{const[o,v]=B.exports.useState(""),[f,b]=B.exports.useState(.2),[t,g]=B.exports.useState({});return i("div",{children:[e("input",{type:"file",onChange:r=>{let h=r.target.files[0];A(h,f).then(s=>{v(s.afterSrc),g(s)})}}),e(C,{placeholder:"\u538B\u7F29\u6BD4\u4F8B",value:f,onChange:r=>{b(r)}}),e("div",{children:i("table",{style:{width:300,margin:20},children:[e("thead",{children:i("tr",{children:[e("th",{}),e("th",{children:"\u538B\u7F29\u524D"}),e("th",{children:"\u538B\u7F29\u540E"}),e("th",{children:"\u538B\u7F29\u6BD4\u4F8B"})]})}),e("tbody",{children:i("tr",{children:[e("td",{children:"\u5927\u5C0F"}),i("td",{children:[t.beforeKB,"kb"]}),i("td",{children:[t.afterKB,"kb"]}),i("td",{children:[Math.ceil(100-t.afterKB/t.beforeKB*100)," ","%"]})]})})]})}),e("br",{}),i("div",{children:[i("div",{children:[e("p",{children:"\u539F\u56FE"}),e("img",{src:t.beforeSrc,alt:"",style:{maxWidth:"80vw"}}),e("br",{}),e("button",{onClick:r=>{I(t.beforeSrc,t.file.name)},children:"\u4E0B\u8F7D"})]}),i("div",{children:[e("p",{children:"\u538B\u7F29\u540E\u56FE\u7247"}),e("img",{src:o,alt:"",style:{maxWidth:"80vw"}}),e("br",{}),e("button",{onClick:r=>{I(t.afterSrc,t.file.name)},children:"\u4E0B\u8F7D"})]})]})]})};function A(o,v){let f=v||.2;return Array.isArray(o)?Promise.all(Array.from(o).map(b=>A(b,f))):new Promise(b=>{const t=new FileReader;t.onload=({target:{result:g}})=>{const r=new Image;r.onload=async()=>{const h=document.createElement("canvas"),s=h.getContext("2d");var c=r.width,l=r.height,n=r.width,a=r.height;const p=parseInt((o.size/1024).toFixed(2));if(1*1024<=p&&p<=10*1024){var d=1600,u=1600;c=n,l=a,(n>d||a>u)&&(n/a>d/u?(c=d,l=Math.round(d*(a/n))):(l=u,c=Math.round(u*(n/a))))}10*1024<=p&&p<=20*1024&&(d=1400,u=1400,c=n,l=a,(n>d||a>u)&&(n/a>d/u?(c=d,l=Math.round(d*(a/n))):(l=u,c=Math.round(u*(n/a))))),h.width=c,h.height=l,s==null||s.clearRect(0,0,c,l),s==null||s.drawImage(r,0,0,c,l);const m=h.toDataURL("image/jpeg",f),w=atob(m.split(",")[1]);let F=w.length;const y=new Uint8Array(new ArrayBuffer(F));for(;F--;)y[F]=w.charCodeAt(F);const S=new File([y],o.name,{type:"image/jpeg"});b({file:S,origin:o,beforeSrc:g,afterSrc:m,beforeKB:Number((o.size/1024).toFixed(2)),afterKB:Number((S.size/1024).toFixed(2))})},r.src=g},t.readAsDataURL(o)})}export{E as default};
